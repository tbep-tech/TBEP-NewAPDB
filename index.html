<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Action Plan Database - A tool for tracking nitrogen load reduction projects in the Tampa Bay watershed"
    />
    <title>Action Plan Database</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="dark-mode.css" />
    <!-- Bootstrap CSS for responsive design -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"
    />
  </head>
  <body>
    <!-- Skip Navigation -->
    <a href="#instruction-content" class="visually-hidden-focusable"
      >Skip to instructions</a
    >

    <header class="header" role="banner">
      <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="content-container">
          <span class="navbar-brand">Action Plan Database</span>
          <button
            class="menu-button"
            aria-label="Toggle navigation menu"
            aria-expanded="false"
            aria-controls="nav-links"
            data-menu-button="burger"
          >
            <span class="menu-button-line"></span>
            <span class="menu-button-line"></span>
            <span class="menu-button-line"></span>
          </button>
          <div class="nav-links" id="nav-links">
            <a
              href="#new-project"
              class="nav-link"
              role="link"
              aria-label="Report new project"
              data-instruction-target="new-project-instructions"
              >Report New Project</a
            >
            <a
              href="#existing-projects"
              class="nav-link"
              role="link"
              aria-label="Update existing project"
              data-instruction-target="existing-projects-instructions"
              >Update Existing Project</a
            >
            <a
              href="#tn-allocation"
              class="nav-link"
              role="link"
              aria-label="Report TN allocation transfer"
              data-instruction-target="tn-allocation-instructions"
              >Report TN Allocation Transfer</a
            >
            <button class="theme-toggle" aria-label="Toggle dark mode">
              <svg
                class="sun-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              <svg
                class="moon-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path
                  d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </nav>
    </header>

    <main
      id="main-content"
      class="container-fluid"
      aria-label="TBEP Action Plan Database Main Content"
    >
      <div class="content-container">
        <!-- Instruction Section -->
        <section class="instruction-section">
          <div class="instruction-content" id="instruction-content">
            <h1>Action Plan Database</h1>
            <p>
              The Action Plan Database is an online tool to collect information
              from partners about planned, ongoing, and completed TN load
              reduction projects. Consortium participants and regulators have
              direct access to input and view projects contained in the
              database. This information is used to estimate the amount of
              nitrogen precluded from entering the bay each year and the level
              of investment made to sustain water quality improvements in Tampa 
              Bay over time. If you have any questions, comments, or suggestions
              about the database please contact Maya Burke (mburke@tbep.org) or 
              Ed Sherwood (esherwood@tbep.org).
            </p>
          </div>
          <img
            fetchpriority="high"
            decoding="async"
            src="https://tbep.org/wp-content/uploads/Tampa-Bay-Yaught-Club-Yvonne-Gougelet-10.jpg?x81949"
            alt="A picture of a boater enjoying a sunny day out on Tampa Bay."
            title="Tampa Bay Yaught Club - Yvonne Gougelet (10)"
            class="instruction-image"
            loading="lazy"
          />
        </section>

        <!-- Report New Project Section -->
        <section id="new-project">
          <div class="report-section" id="new-project-instructions">
            <h2 id="new-project-heading">Report new project</h2>
            <p id="new-project-description">
              To add a new project, please enter the information requested on
              the form below. For education or ongoing projects such as street
              sweeping, you should create a new project for every new year the
              activity was performed.
            </p>
          </div>

          <!-- Form and Calculator Container -->
          <div class="form-calculator-container">
            <div class="form-container">
              <div class="card">
                <div class="card-body">
                  <div class="iframe-container">
                    <iframe
                      width="600"
                      height="1200"
                      src="https://app.smartsheet.com/b/form/98c3743ceec54fd4be1e9a4a23e148cd"
                      title="Smartsheet Form"
                      loading="lazy"
                    >
                      <p>
                        Your browser does not support iframes. Please
                        <a
                          href="https://app.smartsheet.com/b/form/349fcff3e5b540488b9ae84214303e61"
                          target="_blank"
                          rel="noopener noreferrer"
                          >open the form in a new window</a
                        >.
                      </p>
                    </iframe>
                  </div>
                </div>
              </div>
            </div>
            <div class="calculator-container">
              <div class="card">
                <div class="calculator-content">
                  <h2 id="calculator-heading">TN estimation load calculator</h2>
                  <p class="calculator-description" id="calculator-description">
                    Only use this tool if you don't already have a TN estimation
                    number. When in doubt, refer to your own data.
                  </p>
                </div>

                <!-- Calculator Form -->
                <div
                  class="calculator-form"
                  role="region"
                  aria-labelledby="calculator-heading"
                  aria-describedby="calculator-description"
                >
                  <ul
                    class="nav nav-tabs"
                    id="calculatorTabs"
                    role="tablist"
                    aria-label="Calculator Type Selection"
                  >
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link active"
                        id="nps-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#nps"
                        type="button"
                        role="tab"
                        aria-controls="nps"
                        aria-selected="true"
                      >
                        Non-Point Source
                      </button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link"
                        id="ps-tab"
                        data-bs-toggle="tab"
                        data-bs-target="#ps"
                        type="button"
                        role="tab"
                        aria-controls="ps"
                        aria-selected="false"
                      >
                        Point Source
                      </button>
                    </li>
                  </ul>
                  <div class="tab-content" id="calculatorTabsContent">
                    <!-- Non-Point Source Calculator -->
                    <div
                      class="tab-pane fade show active"
                      id="nps"
                      role="tabpanel"
                      aria-labelledby="nps-tab"
                    >
                      <form
                        id="nps-calculator-form"
                        aria-label="Non-Point Source Calculator Form"
                      >
                        <div class="form-group">
                          <label for="npsLandUse" id="npsLandUseLabel"
                            >Land Use</label
                          >
                          <select
                            class="form-select"
                            id="npsLandUse"
                            name="npsLandUse"
                            required
                            aria-describedby="npsLandUseHelp"
                            autocomplete="off"
                          >
                            <option value="">Select Land Use</option>
                          </select>
                        </div>

                        <div class="form-group">
                          <label
                            for="npsTreatmentMethod"
                            id="npsTreatmentMethodLabel"
                            >Treatment Method</label
                          >
                          <select
                            class="form-select"
                            id="npsTreatmentMethod"
                            name="npsTreatmentMethod"
                            required
                            aria-describedby="npsTreatmentMethodHelp"
                            autocomplete="off"
                          >
                            <option value="">Select Treatment Method</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label
                            for="npsTreatmentArea"
                            id="npsTreatmentAreaLabel"
                            >Contributing Project Area (Acres)</label
                          >
                          <input
                            type="number"
                            class="form-control"
                            id="npsTreatmentArea"
                            name="npsTreatmentArea"
                            step="any"
                            min="0"
                            required
                            aria-describedby="npsTreatmentAreaHelp"
                            title="Enter the treatment area in acres. Decimal values are allowed."
                            onblur="setTimeout(() => console.log('Next focused element:', document.activeElement), 0)"
                          />
                        </div>
                        <div class="form-group">
                          <button type="submit" class="btn btn-primary">
                            Calculate NPS TN Load Reduction
                          </button>
                        </div>
                      </form>
                      <div
                        id="nps-calculator-result"
                        aria-live="polite"
                        aria-atomic="true"
                      ></div>
                    </div>

                    <!-- Point Source Calculator -->
                    <div
                      class="tab-pane fade"
                      id="ps"
                      role="tabpanel"
                      aria-labelledby="ps-tab"
                    >
                      <form
                        id="ps-calculator-form"
                        aria-label="Point Source Calculator Form"
                      >
                        <div class="form-group">
                          <label for="psAvgDischarge" id="psAvgDischargeLabel"
                            >Average Total Discharge (MGD)</label
                          >
                          <input
                            type="number"
                            class="form-control"
                            id="psAvgDischarge"
                            name="psAvgDischarge"
                            min="0"
                            step="any"
                            required
                            aria-describedby="psAvgDischargeHelp"
                            title="Enter the average total discharge in Million Gallons per Day (MGD). Decimal values are allowed."
                          />
                        </div>
                        <div class="form-group">
                          <label
                            for="psTNConcentration"
                            id="psTNConcentrationLabel"
                            >TN Concentration (mg/L)</label
                          >
                          <input
                            type="number"
                            class="form-control"
                            id="psTNConcentration"
                            name="psTNConcentration"
                            min="0"
                            step="any"
                            required
                            aria-describedby="psTNConcentrationHelp"
                            title="Enter the Total Nitrogen concentration in milligrams per liter (mg/L). Decimal values are allowed."
                          />
                        </div>
                        <div class="form-group">
                          <label
                            for="psAttenuationFactor"
                            id="psAttenuationFactorLabel"
                            >Attenuation Factor (%)</label
                          >
                          <div class="input-group">
                            <input
                              type="number"
                              class="form-control"
                              id="psAttenuationFactor"
                              name="psAttenuationFactor"
                              min="0"
                              max="100"
                              required
                              aria-describedby="psAttenuationFactorHelp"
                              title="Enter the attenuation factor as a percentage (0-100). Decimal values are allowed."
                            />
                            <span class="input-group-text" aria-hidden="true"
                              >%</span
                            >
                          </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                          Calculate PS TN Load Reduction
                        </button>
                      </form>
                      <div
                        id="ps-calculator-result"
                        aria-live="polite"
                        aria-atomic="true"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Existing Projects Section -->
        <section id="existing-projects" class="mb-5">
          <div class="report-section" id="existing-projects-instructions">
            <div class="sr-only" aria-live="polite">
              Note: This section contains a Smartsheet table that is not fully
              accessible due to platform limitations. The table is hidden from
              keyboard navigation to prevent keyboard traps. If you need
              assistance accessing this information, please contact TBEP for
              support.
            </div>
            <h2 id="existing-projects-heading">Update existing project</h2>
            <p id="existing-projects-description">
              To update an existing project, please locate your project number
              in the list below. From there, you can request access to edit the
              project and submit your changes. For education or ongoing
              projects, ensure you're updating the correct year's entry.
            </p>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="iframe-container reports-container">
                <iframe
                  class="smartsheet-reports-iframe"
                  width="1000"
                  height="700"
                  frameborder="0"
                  src="https://app.smartsheet.com/b/publish?EQBCT=459401b841dd4a089db7ea348bd03308"
                  title="Smartsheet Reports View"
                  loading="lazy"
                  tabindex="-1"
                  aria-hidden="true"
                >
                  <p>
                    Your browser does not support iframes. Please
                    <a
                      href="https://app.smartsheet.com/b/publish?EQBCT=459401b841dd4a089db7ea348bd03308"
                      target="_blank"
                      rel="noopener noreferrer"
                      >open the reports in a new window</a
                    >.
                  </p>
                </iframe>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="iframe-container">
                <iframe
                  width="1000"
                  height="700"
                  src="https://app.smartsheet.com/b/form/0e2dfc54698e4ddf90ff0ae90e969a69"
                  title="Smartsheet Form"
                  loading="lazy"
                >
                  <p>
                    Your browser does not support iframes. Please
                    <a
                      href="https://app.smartsheet.com/b/form/0e2dfc54698e4ddf90ff0ae90e969a69"
                      target="_blank"
                      rel="noopener noreferrer"
                      >open the form in a new window</a
                    >.
                  </p>
                </iframe>
              </div>
            </div>
          </div>
        </section>

        <!-- TN Allocation Transfer Section -->
        <section
          id="tn-allocation"
          aria-labelledby="tn-allocation-heading"
          class="mb-5"
        >
          <div class="report-section" id="tn-allocation-instructions">
            <h2 id="tn-allocation-heading">Report TN allocation transfer</h2>
            <p id="tn-allocation-description">
              Use this form to report transfers of TN allocation between
              entities, consistent with Decision Memo #19. Please ensure you
              have all necessary documentation and approval(s) before reporting
              the transfer. The bay segment(s), source type, and both sending
              and receiving entities must be clearly identified.
            </p>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="iframe-container reports-container">
                <iframe
                  width="900"
                  height="600"
                  src="https://app.smartsheet.com/b/form/8918f2ed52e04edf828bd22b5ce72850"
                  title="TN Allocation Transfer Form"
                  loading="lazy"
                >
                  <p>
                    Your browser does not support iframes. Please
                    <a
                      href="https://app.smartsheet.com/b/form/8918f2ed52e04edf828bd22b5ce72850"
                      target="_blank"
                      rel="noopener noreferrer"
                      >open the form in a new window</a
                    >.
                  </p>
                </iframe>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <footer class="footer" role="contentinfo">
      <div class="content-container">
        <p>&copy; 2024 Action Plan Database. All rights reserved.</p>
      </div>
    </footer>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/CustomEase.min.js"></script>
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize searchable dropdowns
        const searchableDropdowns =
          document.querySelectorAll(".searchable-select");
        searchableDropdowns.forEach((dropdown) => {
          new Choices(dropdown, {
            searchEnabled: true,
            searchPlaceholderValue: "Type to search...",
            placeholder: true,
            placeholderValue: "Select an option",
            removeItemButton: false,
            classNames: {
              containerOuter: "choices form-select",
            },
          });
        });
      });

      // Focus the correct instruction container when a nav link is clicked
      document.addEventListener("DOMContentLoaded", function () {
        document
          .querySelectorAll(".nav-link[data-instruction-target]")
          .forEach(function (link) {
            link.addEventListener("click", function (e) {
              var targetId = link.getAttribute("data-instruction-target");
              var instruction = document.getElementById(targetId);
              if (instruction) {
                // Wait for scroll, then focus
                setTimeout(function () {
                  instruction.focus();
                }, 300);
              }
            });
          });
      });
    </script>
  </body>
</html>
